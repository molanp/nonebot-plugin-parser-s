<div align="center">
<a href="https://v2.nonebot.dev/store">
    <img src="https://raw.githubusercontent.com/fllesser/nonebot-plugin-template/refs/heads/resource/.docs/NoneBotPlugin.svg" width="310" alt="logo">
</a>

## âœ¨ [Nonebot2](https://github.com/nonebot/nonebot2) é“¾æ¥åˆ†äº«è‡ªåŠ¨è§£ææ’ä»¶ âœ¨

</div>


## ğŸ“– ä»‹ç»

| å¹³å°       | è§¦å‘çš„æ¶ˆæ¯å½¢æ€                    | è§†é¢‘ | å›¾é›†          | éŸ³é¢‘   |
| ---------- | --------------------------------- | ---- | ------------- | ------ |
| B ç«™       | av å·/BV å·/é“¾æ¥/çŸ­é“¾/å¡ç‰‡/å°ç¨‹åº | âœ…â€‹  | âœ…â€‹           | âœ…â€‹    |
| æŠ–éŸ³       | é“¾æ¥(åˆ†äº«é“¾æ¥ï¼Œå…¼å®¹ç”µè„‘ç«¯é“¾æ¥)    | âœ…â€‹  | âœ…â€‹           | âŒï¸     |
| å¾®åš       | é“¾æ¥(åšæ–‡ï¼Œè§†é¢‘ï¼Œshow, æ–‡ç« )      | âœ…â€‹  | âœ…â€‹           | âŒï¸     |
| å°çº¢ä¹¦     | é“¾æ¥(å«çŸ­é“¾)/å¡ç‰‡                 | âœ…â€‹  | âœ…â€‹           | âŒï¸     |
| å¿«æ‰‹       | é“¾æ¥(åŒ…å«æ ‡å‡†é“¾æ¥å’ŒçŸ­é“¾)          | âœ…â€‹  | âœ…â€‹           | âŒï¸     |
| acfun      | é“¾æ¥                              | âœ…â€‹  | âŒï¸            | âŒï¸     |
| youtube    | é“¾æ¥(å«çŸ­é“¾)                      | âœ…â€‹  | âŒï¸            | âœ…â€‹    |
| tiktok     | é“¾æ¥                              | âœ…â€‹  | âŒï¸            | âŒï¸     |
| twitter    | é“¾æ¥                              | âœ…â€‹  | âœ…â€‹           | âŒï¸     |
| é…·ç‹—éŸ³ä¹   | é“¾æ¥(åˆ†äº«é“¾æ¥ï¼Œæ­Œæ›²é“¾æ¥)          | âŒï¸   | âŒï¸            | âœ…â€‹    |
| ç½‘æ˜“äº‘éŸ³ä¹ | é“¾æ¥(åˆ†äº«é“¾æ¥ï¼ŒçŸ­é“¾æ¥)            | âŒï¸   | âŒï¸            | âœ…â€‹    |
| æ±½æ°´éŸ³ä¹   | é“¾æ¥(åˆ†äº«é“¾æ¥)                    | âŒï¸   | âŒï¸            | âœ…â€‹    |
| é…·æˆ‘éŸ³ä¹   | é“¾æ¥(åˆ†äº«é“¾æ¥)                    | âŒï¸   | âŒï¸            | âœ…â€‹    |
| ç™¾åº¦è´´å§   | é“¾æ¥                              | æ²¡å†™ | âœ…â€‹(å›¾æ–‡å¸–å­) | ä¸å­˜åœ¨ |
| TapTap  | é“¾æ¥(æ¸¸æˆè¯¦æƒ…ã€å¸–å­é“¾æ¥)              | âœ…  | âœ…  | âŒï¸  |
| ä»Šæ—¥å¤´æ¡ | é“¾æ¥(è§†é¢‘é“¾æ¥)                    | âœ…  | âŒï¸  | âŒï¸  |

æ”¯æŒçš„é“¾æ¥ï¼Œå¯å‚è€ƒ [æµ‹è¯•é“¾æ¥](https://github.com/fllesser/nonebot-plugin-parser/blob/master/tests/others/test_urls.md)

## ğŸ’¿ å®‰è£…

æŠŠæ’ä»¶æ–‡ä»¶å¤¹æ”¾åˆ°æ’ä»¶åŠ è½½ç›®å½•

</details>

## âš™ï¸ é…ç½®

<details>
<summary>é…ç½®é¡¹</summary>

```bash
# [å¯é€‰] nonebot2 å†…ç½®é…ç½®ï¼Œè‹¥æœåŠ¡å™¨ä¸Šä¼ å¸¦å®½å¤ªä½ï¼Œå»ºè®®è°ƒé«˜ï¼Œé˜²æ­¢è¶…æ—¶
API_TIMEOUT=30.0

# [å¯é€‰] B ç«™ cookie, å¿…é¡»å«æœ‰ SESSDATA é¡¹ï¼Œå¯é™„åŠ  B ç«™ AI æ€»ç»“åŠŸèƒ½
# å¦‚æœéœ€è¦é•¿æœŸä½¿ç”¨æ­¤å‡­æ®åˆ™ä¸åº”è¯¥åœ¨æµè§ˆå™¨ç™»å½•è´¦æˆ·å¯¼è‡´ cookie è¢«åˆ·æ–°ï¼Œå»ºè®®æ³¨å†Œä¸ªå°å·è·å–
# å„é¡¹è·å–æ–¹å¼ https://nemo2011.github.io/bilibili-api/#/get-credential
# ac_time_value ç›¸å¯¹ç‰¹æ®Šï¼Œä»…ç”¨äºåˆ·æ–° Cookies
# Bç«™ç½‘é¡µæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œè¿›å…¥æ§åˆ¶å°ï¼Œè¾“å…¥ window.localStorage.ac_time_value å³å¯è·å–å…¶å€¼ã€‚
parser_bili_ck="SESSDATA=xxxxxxxxxx;ac_time_value=131231241231241"

# [å¯é€‰] å…è®¸çš„ B ç«™è§†é¢‘ç¼–ç ï¼Œè¶Šé å‰çš„ç¼–ç ä¼˜å…ˆçº§è¶Šé«˜
# å¯é€‰ "avc"(H.264ï¼Œä½“ç§¯è¾ƒå¤§), "hev"(HEVC), "av01"(AV1)
# åä¸¤é¡¹åœ¨ä¸åŒè®¾å¤‡å¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œå¦‚éœ€å®Œå…¨é¿å…ï¼Œå¯åªå¡«ä¸€é¡¹ï¼Œå¦‚ '["avc"]'
parser_bili_video_codes=["avc", "av01", "hev"]

# [å¯é€‰] B ç«™è§†é¢‘æ¸…æ™°åº¦
# 360p(16), 480p(32), 720p(64), 1080p(80), 1080p+(112), 1080p_60(116), 4k(120)
parser_bili_video_quality=80

# [å¯é€‰] å°çº¢ä¹¦ Cookie, éƒ¨åˆ†é“¾æ¥è§£ææœ‰æ°´å°ï¼Œå¯å¡«
parser_xhs_ck=""

# [å¯é€‰] Youtube Cookie, Youtube è§†é¢‘å› äººæœºæ£€æµ‹ä¸‹è½½å¤±è´¥ï¼Œéœ€å¡«
parser_ytb_ck=""

# [å¯é€‰] ä»£ç†, ä»…ä½œç”¨äº youtube, tiktok è§£æ
# æ¨ç‰¹è§£æä¼šè‡ªåŠ¨è¯»å–ç¯å¢ƒå˜é‡ä¸­çš„ http_proxy / https_proxy(ä»£ç†è½¯ä»¶é€šå¸¸ä¼šè‡ªåŠ¨è®¾ç½®)
parser_proxy=None

# [å¯é€‰] éŸ³é¢‘è§£æï¼Œæ˜¯å¦éœ€è¦ä¸Šä¼ ç¾¤æ–‡ä»¶
parser_need_upload=False

# [å¯é€‰] éŸ³é¢‘è§£æï¼Œæ˜¯å¦å‘é€æ­Œè¯
parser_send_lyrics=True

# [å¯é€‰] éŸ³é¢‘è§£æï¼Œæ˜¯å¦åˆå¹¶å‘é€æ¶ˆæ¯
parser_combine_message=True

# [å¯é€‰] éŸ³é¢‘è§£æï¼Œæ˜¯å¦ä¼˜å…ˆä½¿ç”¨é«˜è´¨é‡éŸ³è´¨
parser_prefer_high_quality=True

# [å¯é€‰] éŸ³é¢‘è§£æï¼Œè¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šç§’
parser_audio_timeout=30.0

# [å¯é€‰] è§†é¢‘ï¼Œå›¾ç‰‡ï¼ŒéŸ³é¢‘æ˜¯å¦ä½¿ç”¨ base64 å‘é€
# æ³¨æ„ï¼šç¼–è§£ç å’Œä¼ è¾“ base64 ä¼šå ç”¨æ›´å¤šçš„å†…å­˜,æ€§èƒ½å’Œå¸¦å®½, ç”šè‡³å¯èƒ½ä¼šä½¿ websocket è¿æ¥å´©æºƒ
# å› æ­¤è¯¥é…ç½®é¡¹ä»…æ¨è nonebot å’Œ åè®®ç«¯ä¸åœ¨åŒä¸€æœºå™¨çš„ç”¨æˆ·é…ç½®
parser_use_base64=False

# [å¯é€‰] è§†é¢‘æœ€å¤§è§£ææ—¶é•¿ï¼Œå•ä½ï¼šç§’
parser_duration_maximum=480

# [å¯é€‰] éŸ³è§†é¢‘ä¸‹è½½æœ€å¤§æ–‡ä»¶å¤§å°ï¼Œå•ä½ MBï¼Œè¶…è¿‡è¯¥é…ç½®å°†é˜»æ–­ä¸‹è½½
parser_max_size=90

# [å¯é€‰] å…¨å±€ç¦æ­¢çš„è§£æ
# ç¤ºä¾‹ parser_disabled_platforms=["bilibili", "douyin"] è¡¨ç¤ºç¦æ­¢äº†å“”å“©å“”å“©å’ŒæŠ–éŸ³
# å¯é€‰å€¼: ["bilibili", "douyin", "kuaishou", "twitter", "youtube", "acfun", "tiktok", "weibo", "xiaohongshu"]
parser_disabled_platforms=["twitter"]

# [å¯é€‰] æ˜¯å¦åœ¨è§£æç»“æœä¸­é™„åŠ åŸå§‹URL
parser_append_url=False

# [å¯é€‰] æ˜¯å¦éœ€è¦è½¬å‘åª’ä½“å†…å®¹(è¶…è¿‡ 4 é¡¹æ—¶å§‹ç»ˆä½¿ç”¨åˆå¹¶è½¬å‘)
parser_need_forward_contents=True
```

</details>


## ğŸ‰ ä½¿ç”¨

|   æŒ‡ä»¤   |         æƒé™          | éœ€è¦@ | èŒƒå›´ |       è¯´æ˜        |
| :------: | :-------------------: | :---: | :--: | :---------------: |
| å¼€å¯è§£æ | SUPERUSER/OWNER/ADMIN |  æ˜¯   | ç¾¤èŠ |     å¼€å¯è§£æ      |
| å…³é—­è§£æ | SUPERUSER/OWNER/ADMIN |  æ˜¯   | ç¾¤èŠ |     å…³é—­è§£æ      |
|    bm    |           -           |  å¦   | ç¾¤èŠ |   ä¸‹è½½ B ç«™éŸ³é¢‘   |
|    ym    |           -           |  å¦   | ç¾¤èŠ | ä¸‹è½½ youtube éŸ³é¢‘ |
|  blogin  |       SUPERUSER       |  å¦   | ç§èŠ | æ‰«ç è·å– B ç«™å‡­è¯ |

## ğŸ§© æ‰©å±•

> [!IMPORTANT]
> æ’ä»¶è‡ª `v2.2.0` ç‰ˆæœ¬å¼€å§‹æ”¯æŒè‡ªå®šä¹‰è§£æå™¨ï¼Œé€šè¿‡ç»§æ‰¿ `BaseParser` ç±»å¹¶å®ç° `platform`, `handle` å³å¯

<details>
<summary>å®Œæ•´ç¤ºä¾‹</summary>

```python
from re import Match
from typing import ClassVar

from httpx import AsyncClient
from nonebot import require

require("nonebot_plugin_parser")
from nonebot_plugin_parser.parsers import BaseParser, Platform, handle

class ExampleParser(BaseParser):
    """ç¤ºä¾‹è§†é¢‘ç½‘ç«™è§£æå™¨"""

    platform: ClassVar[Platform] = Platform(name="example", display_name="ç¤ºä¾‹ç½‘ç«™")

    @handle("ex.short", r"ex\.short/\w+)")
    async def _parse_short_link(self, searched: Match[str]):
        """è§£æçŸ­é“¾"""
        url = f"https://{searched.group(0)}"
        # é‡å®šå‘å†è§£æï¼Œè¯·ç¡®ä¿é‡å®šå‘é“¾æ¥çš„ handle å­˜åœ¨
        # æ¯”å¦‚ url é‡å®šå‘åˆ° example.com/... å°±ä¼šè°ƒç”¨ _parse è§£æ
        return await self.parse_with_redirect(url)

    @handle("example.com", r"example\.com/video/(?P<video_id>\w+)")
    @handle("exam.ple", r"exam\.ple/(?P<video_id>\w+)")
    async def _parse(self, searched: Match[str]):
        # 1. æå–è§†é¢‘ ID
        video_id = searched.group("video_id")

        # 2. è¯·æ±‚ API è·å–è§†é¢‘ä¿¡æ¯
        async with AsyncClient(headers=self.headers, timeout=self.timeout) as client:
            resp = await client.get(f"https://api.example.com/video/{video_id}")
            resp.raise_for_status()
            data = resp.json()

        # 3. æå–æ•°æ®
        title = data["title"]
        author_name = data["author"]["name"]
        avatar_url = data["author"]["avatar"]
        video_url = data["video_url"]
        cover_url = data["cover_url"]
        duration = data["duration"]
        timestamp = data["publish_time"]
        description = data.get("description", "")

        # 4. è§†é¢‘å†…å®¹
        author = self.create_author(author_name, avatar_url)
        video = self.create_video_content(video_url, cover_url, duration)

        # 5. å›¾é›†å†…å®¹
        image_urls = data.get("images")
        images = self.create_image_contents(image_urls)

        # 6. è¿”å›è§£æç»“æœ
        return self.result(
            title=title,
            text=description,
            author=author,
            contents=[video, *images],
            timestamp=timestamp,
            url=f"https://example.com/video/{video_id}",
        )

```

</details>
<details>
<summary>è¾…åŠ©å‡½æ•°</summary>

> æ„å»ºä½œè€…ä¿¡æ¯

```python
author = self.create_author(
    name="ä½œè€…å",
    avatar_url="https://example.com/avatar.jpg",   # å¯é€‰ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½
    description="ä¸ªæ€§ç­¾å"                          # å¯é€‰
)
```

> æ„å»ºè§†é¢‘å†…å®¹

```python
# æ–¹å¼1ï¼šä¼ å…¥ URLï¼Œè‡ªåŠ¨ä¸‹è½½
video = self.create_video_content(
    url_or_task="https://example.com/video.mp4",
    cover_url="https://example.com/cover.jpg",  # å¯é€‰
    duration=120.5                               # å¯é€‰ï¼Œå•ä½ï¼šç§’
)

# æ–¹å¼2ï¼šä¼ å…¥å·²åˆ›å»ºçš„ä¸‹è½½ä»»åŠ¡
from nonebot_plugin_parser.download import DOWNLOADER
video_task = DOWNLOADER.download_video(url, ext_headers=self.headers)
video = self.create_video_content(
    url_or_task=video_task,
    cover_url=cover_url,
    duration=duration
)
```

> æ„å»ºå›¾é›†å†…å®¹

```python
# å¹¶å‘ä¸‹è½½å›¾é›†å†…å®¹
images = self.create_image_contents([
    "https://example.com/img1.jpg",
    "https://example.com/img2.jpg",
])
```

> æ„å»ºå›¾æ–‡å†…å®¹(é€‚ç”¨äºç±»ä¼¼ Bilibili åŠ¨æ€å›¾æ–‡æ··æ’)

```python
graphics = self.create_graphics_content(
    image_url="https://example.com/image.jpg",
    text="å›¾ç‰‡å‰çš„æ–‡å­—è¯´æ˜",  # å¯é€‰
    alt="å›¾ç‰‡æè¿°"            # å¯é€‰ï¼Œå±…ä¸­æ˜¾ç¤º
)
```

> åˆ›å»ºåŠ¨å›¾å†…å®¹ï¼ˆGIF)ï¼Œå¹³å°ä¸€èˆ¬åªæä¾›è§†é¢‘ï¼ˆåç»­æ’ä»¶ä¼šåšè‡ªåŠ¨è½¬ä¸º gif çš„å¤„ç†)

```python
dynamics = self.create_dynamic_contents([
    "https://example.com/dynamic1.mp4",
    "https://example.com/dynamic2.mp4",
])
```

> é‡å®šå‘ url

```python
real_url = await self.get_redirect_url(
    url="https://short.url/abc",
    headers=self.headers  # å¯é€‰
)

> åˆ›å»ºè´´çº¸è¡¨æƒ…

```python
stickers = self.create_sticker_contents(
    url="http://xx",
    size="small"  # å¯é€‰
    # smallå’Œæ–‡å­—å¤§å°ç›¸åŒ
    # mediumæ˜¯æ–‡å­—å¤§å°ä¸¤å€
    # largeæ˜¯æ–‡å­—å¤§å°ä¸‰å€
)
```

</details>

## ğŸ‰ è‡´è°¢

[nonebot-plugin-resolver](https://github.com/zhiyu1998/nonebot-plugin-resolver)
[nonebot-plugin-parser](https://github.com/fllesser/nonebot-plugin-parser)
[nonebot-plugin-parser-m](https://github.com/LoCCai/nonebot-plugin-parser-m)
[parse-video-py](https://github.com/wujunwei928/parse-video-py)
